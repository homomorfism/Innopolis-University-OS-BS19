{
 "cells": [],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.6"
  },
  "pycharm": {
   "stem_cell": {
    "cell_type": "raw",
    "source": [
     "\n",
     "\n",
     "#### Exercise 1\n",
     "\n",
     "Create a program that declares a variable n,\n",
     "forks a new process and prints ```“Hello from\n",
     "parent [PID - n]”``` and ```“Hello from child [PID -\n",
     "n]”``` from parent and child processes\n",
     "respectively. Run it 10 times and explain the\n",
     "output\n",
     "• Hint: to run it N times you can write a shell\n",
     "script\n",
     "\n",
     "\n",
     "\n",
     "\n",
     "#### Solution 1\n",
     "\n",
     "Each process that we create has his unique number, that's why pid of each created process is incrementing\n",
     "\n",
     "- ex1.c\n",
     "\n",
     "```\n",
     "#include <stdio.h>\n",
     "#include <sys/types.h>\n",
     "\n",
     "int main() {\n",
     "\tint n;\n",
     "\tpid_t p_id = fork();\n",
     "\n",
     "\tif (p_id == 0) {\n",
     "\t\tprintf(\"Hello from child [%d - %d]\\n\", getpid(), n);\n",
     "\t} else {\n",
     "\t\tprintf(\"Hello from parent [%d - %d]\\n\", getpid(), n);\n",
     "\t}\n",
     "}```\n",
     "\n",
     "- ex1.sh\n",
     "\n",
     "```for i in {1..10}; do ./ex1; done```\n",
     "\n",
     "\n",
     "\n",
     "#### Exercise 2\n",
     "\n",
     "Write a program that calls ```fork()``` in a loop 3\n",
     "times and sleeps for 5 seconds. Run the\n",
     "program in background and run pstree\n",
     "command several times. Look at the output\n",
     "and tell how many processes are created.\n",
     "Explain the result.\n",
     " Change the program so that it would call ```fork()```\n",
     "5 times. See how the result changes\n",
     "\n",
     "\n",
     "\n",
     "#### Solution 2\n",
     "\n",
     "We are creating recursively in total 8 processes:\n",
     "- when creating each process the instructions are also copied, so:\n",
     " * \t\t\"main\" process in loop creates 3 process:\n",
     " * \t\t\tfirst process creates 2 child processes (first iteration is completes, needed 2), and first child create also another process\n",
     " * \t\t\tsecond process created 1 child process (two iterations are gone), and this child also created one more child process (thrird iteration)\n",
     " * \t\t\tthird process does not create anything (three interations are gone)\n",
     "\n",
     "```\n",
     "#include <stdio.h>\n",
     "#include <sys/types.h>\n",
     "#include <unistd.h>\n",
     "\n",
     "int main() {\n",
     "\tfor (int i = 0; i < 3; ++i)\n",
     "\t{\n",
     "\t\tfork();\n",
     "\t\tsleep(5);\n",
     "\t}\n",
     "}```\n",
     "\n",
     "\n",
     "\n",
     "#### Exercise 3\n",
     "\n",
     "Write your own simplistic shell. It should read\n",
     "user input and be able to run a command\n",
     "without parameters, such as ```pwd, ls, top,\n",
     "pstree``` and so on\n",
     "- Hint: use ```man system```\n",
     "\n",
     "\n",
     "\n",
     "#### Solution 3\n",
     "\n",
     "```system``` is used for executing instructions from shell\n",
     "\n",
     "```\n",
     "#include <stdio.h>\n",
     "\n",
     "int main() {\n",
     "\tchar buf[200];\n",
     "\twhile(1) {\n",
     "\t\tscanf(\"%s\", buf);\n",
     "\t\tsystem(buf);\n",
     "\t}\n",
     "}```\n",
     "\n",
     "\n",
     "\n",
     "#### Exercise 4\n",
     "\n",
     "Extend your previous code to handle\n",
     "commands with parameters and running\n",
     "processes in background\n",
     "- Hint: use ```man fork``` and ```man execve```\n",
     "\n",
     "\n",
     "\n",
     "#### Solution 4\n",
     "\n",
     "The function ```read_cmd``` parces input line into words & returns array on strings, which will be executing in the child process.\n",
     "\n",
     "Note: it is better to use ```scanf``` instead of ```fgets```.\n",
     "```\n",
     "#include <stdio.h>\n",
     "#include <stdlib.h>\n",
     "#include <string.h>\n",
     "#include <sys/types.h>\n",
     "#include <unistd.h>\n",
     "\n",
     "char **read_cmd() {\n",
     "    char** args = (char**)malloc(sizeof(char*) * 100);\n",
     "\n",
     "\n",
     "    char buf[100];\n",
     "    fgets(buf, 100, stdin);\n",
     "    //printf(\"Entered string:%s, length:%llu\", buf, strlen(buf));\n",
     "\n",
     "    int curr_word = 0, curr_letter = 0;\n",
     "    args[curr_word] = (char*)malloc(sizeof(char) * 100);\n",
     "\n",
     "    for (int i = 0; i < strlen(buf); ++i) {\n",
     "        char symbol = buf[i];\n",
     "\n",
     "        if (symbol == ' ') {\n",
     "            args[curr_word][curr_letter] = '\\n';\n",
     "            curr_word++;\n",
     "            args[curr_word] = (char*)malloc(sizeof(char) * 100);\n",
     "            curr_letter = 0;\n",
     "\n",
     "            continue;\n",
     "        }\n",
     "\n",
     "        if (symbol == '\\n') {\n",
     "            args[curr_word][curr_letter] = '\\n';\n",
     "            args[curr_word + 1] = (char*)0;\n",
     "            break;\n",
     "        }\n",
     "\n",
     "        args[curr_word][curr_letter] = symbol;\n",
     "        curr_letter++;\n",
     "\n",
     "    }\n",
     "    return args;\n",
     "}\n",
     "\n",
     "\n",
     "\n",
     "int main() {\n",
     "\n",
     "\twhile(1) {\n",
     "\t\tchar **args = read_cmd();\n",
     "\n",
     "\t\tint pid = fork();\n",
     "\t\tif (pid == 0) {\n",
     "\t\t\texecve(args[0], args, (char*)0);\n",
     "\t\t}\n",
     "\t}\n",
     "}\n",
     "```\n",
     "\n",
     "\n"
    ],
    "metadata": {
     "collapsed": false
    }
   }
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}